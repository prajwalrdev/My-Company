document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("main-content");e&&(e.style.display="block");const t=document.getElementById("themeSwitcher"),n=document.body,s=localStorage.getItem("theme");s&&n.classList.add(s),t.addEventListener("click",()=>{n.classList.contains("dark-mode")?(n.classList.remove("dark-mode"),localStorage.setItem("theme","light-mode")):(n.classList.add("dark-mode"),localStorage.setItem("theme","dark-mode"))}),async function(){try{if(navigator.userAgent.includes("bot")||navigator.userAgent.includes("crawler"))return;const e=new VisitCounter;await e.incrementVisit(),console.log("Visit tracked successfully")}catch(e){console.error("Error tracking visit:",e)}}(),window.addEventListener("load",function(){const e=document.querySelector(".preloader"),t=document.getElementById("main-content"),n=document.querySelector(".site-footer");e&&(e.style.transition="opacity 0.5s ease",e.style.opacity="0",e.style.visibility="hidden"),t&&setTimeout(()=>{e.style.display="none",t.style.display="block",n&&(n.style.visibility="visible")},500);const s=document.createElement("div");s.className="scroll-progress",document.body.appendChild(s),window.addEventListener("scroll",()=>{const e=(document.body.scrollTop||document.documentElement.scrollTop)/(document.documentElement.scrollHeight-document.documentElement.clientHeight)*100;s.style.width=e+"%"});const o=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&e.target.classList.add("visible")})},{threshold:.1});document.querySelectorAll(".main-section").forEach(e=>{o.observe(e)}),document.querySelectorAll("img").forEach(e=>{e.complete?e.classList.add("loaded"):e.addEventListener("load",function(){this.classList.add("loaded")})});const i=document.getElementById("contactForm");i&&i.addEventListener("submit",async function(e){e.preventDefault();const t=grecaptcha.getResponse();if(!t)return void alert("Please complete the reCAPTCHA.");const n=i.elements.name?i.elements.name.value:"",s=i.elements.email?i.elements.email.value:"",o=i.elements.message?i.elements.message.value:"";try{await firebase.firestore().collection("contacts").add({name:n,email:s,message:o,recaptchaToken:t,timestamp:firebase.firestore.FieldValue.serverTimestamp()}),window.location.href="thank-you.html"}catch(e){alert("Submission failed: "+e.message)}});const a=document.getElementById("fileInput"),c=document.getElementById("filePreview");a&&c&&a.addEventListener("change",function(){if(this.files&&this.files[0]){const e=this.files[0],t=(e.size/1024/1024).toFixed(2);if(c.textContent=`Selected: ${e.name} (${t}MB)`,e.type.startsWith("image/")){const t=new FileReader;t.onload=function(e){const t=document.createElement("img");t.src=e.target.result,t.style.maxWidth="200px",t.style.marginTop="10px",c.appendChild(t)},t.readAsDataURL(e)}}else c.textContent="",c.innerHTML=""});const l=document.getElementById("clearBtn");l&&i&&l.addEventListener("click",function(){i.reset(),c&&(c.textContent="",c.innerHTML="");const e=new bootstrap.Toast(document.getElementById("toast"));document.getElementById("toastMessage").textContent="Form cleared!",e.show()}),window.addEventListener("scroll",function(){const e=document.querySelector(".navbar"),t=document.querySelectorAll(".nav-link"),n=window.scrollY;n>50?e.classList.add("scrolled"):e.classList.remove("scrolled"),t.forEach(e=>{const t=document.querySelector(e.getAttribute("href"));if(t){const s=t.offsetTop-100,o=s+t.offsetHeight;n>=s&&n<o?e.classList.add("active"):e.classList.remove("active")}})}),document.querySelectorAll(".nav-link").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault(),document.querySelectorAll(".nav-link").forEach(e=>e.classList.remove("active")),this.classList.add("active");const t=document.querySelector(this.getAttribute("href"));if(t){const e=80,n=t.getBoundingClientRect().top+window.pageYOffset-e;window.scrollTo({top:n,behavior:"smooth"})}})}),document.addEventListener("click",function(e){const t=document.querySelector(".navbar-collapse"),n=document.querySelector(".custom-toggler");!t.classList.contains("show")||t.contains(e.target)||n.contains(e.target)||new bootstrap.Collapse(t).hide()})}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=this.getAttribute("href");if(t&&"#"!==t){const e=document.querySelector(t);if(e){const t=80,n=e.getBoundingClientRect().top-t;window.scrollTo({top:n,behavior:"smooth"})}}})}),document.addEventListener("DOMContentLoaded",function(){document.getElementById("submissionDate").value=(new Date).toISOString();const e="true"===localStorage.getItem("isAdmin"),t=document.getElementById("viewSubmissions");async function n(){try{const e=await fetch("/.netlify/functions/get-submissions"),t=await e.json(),n=document.getElementById("submissionsTableBody");n.innerHTML="",t.forEach(e=>{const t=document.createElement("tr");t.innerHTML=`\n              <td>${new Date(e.data["submission-date"]).toLocaleString()}</td>\n              <td>${e.data.name}</td>\n              <td>${e.data.last_name}</td>\n              <td>${e.data.email}</td>\n              <td>${e.data.message}</td>\n              <td>${e.data.attachment?"Yes":"No"}</td>\n              <td>\n                <button class="btn btn-sm btn-info view-details" data-submission-id="${e.id}">\n                  <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 4.5C7.305 4.5 3.135 7.634 1.5 12c1.635 4.366 5.805 7.5 10.5 7.5s8.865-3.134 10.5-7.5C20.865 7.634 16.695 4.5 12 4.5zm0 12c-2.485 0-4.5-2.015-4.5-4.5s2.015-4.5 4.5-4.5 4.5 2.015 4.5 4.5-2.015 4.5-4.5 4.5zm0-7a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5z"/></svg>\n                </button>\n                <button class="btn btn-sm btn-danger delete-submission" data-submission-id="${e.id}">\n                  <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M3 6h18v2H3V6zm2 3h14v13a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V9zm5 3v7h2v-7h-2zm4 0v7h2v-7h-2zm-8 0v7h2v-7H7z"/></svg>\n                </button>\n              </td>\n            `,n.appendChild(t)}),document.querySelectorAll(".view-details").forEach(e=>{e.addEventListener("click",s)}),document.querySelectorAll(".delete-submission").forEach(e=>{e.addEventListener("click",o)})}catch(e){console.error("Error loading submissions:",e),showToast("Error loading submissions","error")}}async function s(e){const t=e.target.closest("button").dataset.submissionId;try{const e=await fetch(`/.netlify/functions/get-submission/${t}`),n=await e.json(),s=new bootstrap.Modal(document.getElementById("submissionDetailsModal"));document.getElementById("submissionDetailsBody").innerHTML=`\n            <dl class="row">\n              <dt class="col-sm-3">Date</dt>\n              <dd class="col-sm-9">${new Date(n.data["submission-date"]).toLocaleString()}</dd>\n              \n              <dt class="col-sm-3">Name</dt>\n              <dd class="col-sm-9">${n.data.name}</dd>\n              \n              <dt class="col-sm-3">Last Name</dt>\n              <dd class="col-sm-9">${n.data.last_name}</dd>\n              \n              <dt class="col-sm-3">Email</dt>\n              <dd class="col-sm-9">${n.data.email}</dd>\n              \n              <dt class="col-sm-3">Message</dt>\n              <dd class="col-sm-9">${n.data.message}</dd>\n              \n              ${n.data.attachment?`\n                <dt class="col-sm-3">Attachment</dt>\n                <dd class="col-sm-9">\n                  <a href="${n.data.attachment}" target="_blank" class="btn btn-sm btn-primary">\n                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M5 20h14v-2H5v2zm7-18C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 14.59V8h-2v8.59l-3.29-3.3-1.42 1.42L12 19.41l5.71-5.7-1.42-1.42-3.29 3.3z"/></svg>Download\n                  </a>\n                </dd>\n              `:""}\n            </dl>\n          `,s.show()}catch(e){console.error("Error loading submission details:",e),showToast("Error loading submission details","error")}}async function o(e){if(!confirm("Are you sure you want to delete this submission?"))return;const t=e.target.closest("button").dataset.submissionId;try{await fetch(`/.netlify/functions/delete-submission/${t}`,{method:"DELETE"}),showToast("Submission deleted successfully","success"),n()}catch(e){console.error("Error deleting submission:",e),showToast("Error deleting submission","error")}}e&&(t.style.display="block"),t.addEventListener("click",function(){new bootstrap.Modal(document.getElementById("submissionsModal")).show(),n()}),document.getElementById("exportSubmissions").addEventListener("click",async function(){try{const e=await fetch("/.netlify/functions/get-submissions"),t=[["Date","Name","Last Name","Email","Message","Attachment"],...(await e.json()).map(e=>[new Date(e.data["submission-date"]).toLocaleString(),e.data.name,e.data.last_name,e.data.email,e.data.message,e.data.attachment?"Yes":"No"])].map(e=>e.join(",")).join("\n"),n=new Blob([t],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");s.href=URL.createObjectURL(n),s.download=`submissions_${(new Date).toISOString().split("T")[0]}.csv`,s.click()}catch(e){console.error("Error exporting submissions:",e),showToast("Error exporting submissions","error")}});const i=localStorage.getItem("hasVisited"),a=JSON.parse(localStorage.getItem("visitorInfo")||"{}");if(!i){new bootstrap.Modal(document.getElementById("welcomeModal")).show()}const c=document.getElementById("visitorRegistrationForm"),l=document.getElementById("completeRegistration"),d=document.getElementById("visitorName"),r=document.getElementById("visitorEmail");if(c&&l&&l.addEventListener("click",function(){if(c.checkValidity()){const e=bootstrap.Modal.getInstance(document.getElementById("welcomeModal"));e&&e.hide(),d&&localStorage.setItem("visitorName",d.value),r&&localStorage.setItem("visitorEmail",r.value)}else c.classList.add("was-validated")}),d&&(d.value=localStorage.getItem("visitorName")||""),r&&(r.value=localStorage.getItem("visitorEmail")||""),i&&Object.keys(a).length>0){const e=document.createElement("input");e.type="hidden",e.name="visitor_info",e.value=JSON.stringify(a),document.getElementById("contactForm").appendChild(e)}if(a.name){const e=document.getElementById("name");e&&(e.value=a.name)}if(a.email){const e=document.getElementById("email");e&&(e.value=a.email)}}),document.getElementById("contactForm").addEventListener("submit",async function(e){if(e.preventDefault(),!this.checkValidity())return e.stopPropagation(),void this.classList.add("was-validated");const t=this.querySelector('button[type="submit"]'),n=t.querySelector(".button-text"),s=t.querySelector(".spinner-border");t.disabled=!0,n.textContent="Sending...",s.classList.remove("d-none");try{const e=new FormData(this);e.append("submission-date",(new Date).toISOString());if(!(await fetch("/",{method:"POST",body:e})).ok)throw new Error("Failed to submit form");showToast("Message sent successfully!","success"),this.reset(),this.classList.remove("was-validated"),t.disabled=!1,n.textContent="Submit",s.classList.add("d-none"),setTimeout(()=>{window.location.href="thank-you.html"},1500)}catch(e){console.error("Error submitting form:",e),showToast("Error sending message. Please try again.","error"),t.disabled=!1,n.textContent="Submit",s.classList.add("d-none")}}),document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector(".custom-toggler"),t=document.getElementById("navbar-collapse-toggle");e&&t&&(t.addEventListener("show.bs.collapse",function(){e.classList.remove("collapsed")}),t.addEventListener("hide.bs.collapse",function(){e.classList.add("collapsed")}),t.classList.contains("show")||e.classList.add("collapsed"))});const o=document.querySelectorAll(".animated-item"),i=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("is-visible"),i.unobserve(e.target))})},{threshold:.1});o.forEach(e=>{i.observe(e)}),function(){if("undefined"==typeof firebase||"function"!=typeof firebase.firestore)return;"undefined"==typeof db&&"function"==typeof initializeFirebase&&initializeFirebase();let e=localStorage.getItem("site_uuid");e||(e=([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)),localStorage.setItem("site_uuid",e));const t=window.location.pathname.split("/").pop()||"homepage",n=db.collection("users").doc(e),s=db.collection("analytics").doc("website_visits"),o=db.collection("analytics").doc("page_views");!async function(){try{const e=await n.get(),i=new Date;if(e.exists){const s=e.data().pageViews||{};s[t]=(s[t]||0)+1,await n.update({lastVisit:i,pageViews:s})}else await n.set({firstVisit:i,lastVisit:i,pageViews:{[t]:1}}),await s.set({uniqueVisitors:firebase.firestore.FieldValue.increment(1)},{merge:!0});await o.set({[t]:firebase.firestore.FieldValue.increment(1)},{merge:!0})}catch(e){console.error("Analytics tracking error:",e)}}()}(),function(){const e=document.getElementById("visitorModal"),t=document.getElementById("visitorModalForm");if(!e||!t)return;localStorage.getItem("visitorInfo")||(e.style.display="flex",document.body.style.overflow="hidden",setTimeout(()=>{t.elements[0].focus()},100)),e.addEventListener("keydown",function(e){"Escape"===e.key&&e.preventDefault()}),e.addEventListener("click",function(t){(t.target===e||t.target.classList.contains("visitor-modal__backdrop"))&&t.stopPropagation()}),t.addEventListener("keydown",function(e){const n=t.querySelectorAll("input, button"),s=n[0],o=n[n.length-1];"Tab"===e.key&&(e.shiftKey&&document.activeElement===s?(e.preventDefault(),o.focus()):e.shiftKey||document.activeElement!==o||(e.preventDefault(),s.focus()))}),t.addEventListener("submit",function(n){n.preventDefault();const s=t.visitorName.value.trim(),o=t.visitorEmail.value.trim();if(s.length<2||!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(o))return t.visitorName.classList.toggle("is-invalid",s.length<2),void t.visitorEmail.classList.toggle("is-invalid",!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(o));localStorage.setItem("visitorInfo",JSON.stringify({name:s,email:o})),window.firebase&&firebase.firestore&&firebase.firestore().collection("visitors").add({name:s,email:o,timestamp:firebase.firestore.FieldValue.serverTimestamp()}).catch(function(e){console.error("Error saving visitor info:",e)}),e.style.display="none",document.body.style.overflow=""})}(),function(){const e=document.getElementById("mobileSidebar"),t=document.getElementById("sidebarOpenBtn"),n=document.getElementById("sidebarCloseBtn"),s=document.getElementById("sidebarThemeSwitcher");function o(){e.classList.remove("open"),e.setAttribute("inert",""),document.body.style.overflow="",t.focus()}e&&t&&n&&s&&(t.addEventListener("click",function(){e.classList.add("open"),e.removeAttribute("aria-hidden"),e.removeAttribute("inert"),document.body.style.overflow="hidden",setTimeout(()=>{const t=e.querySelector(".mobile-sidebar__nav a");t&&t.focus()},100)}),n.addEventListener("click",o),document.addEventListener("click",function(n){e.classList.contains("open")&&!e.contains(n.target)&&n.target!==t&&o()}),document.addEventListener("keydown",function(t){"Escape"===t.key&&e.classList.contains("open")&&o()}),s.addEventListener("click",function(){document.getElementById("themeSwitcher").click()}))}()});